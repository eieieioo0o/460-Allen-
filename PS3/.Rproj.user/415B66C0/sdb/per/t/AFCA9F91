{
    "contents" : "# this is a code for Treb Allen's trade course.\na = getwd();\nsetwd(a)\nrequire('foreign')\nrequire('plm')\nrequire('mFilter')\nrequire('ggplot2')\nrequire(\"vars\")\nrequire(\"stats\")\nrequire(\"xlsx\")\nrequire(\"reshape2\")\nrequire(\"stargazer\")\nrequire(\"grid\")\nrequire(\"gridExtra\")\nrequire(\"R.matlab\")\nrequire(\"car\")\nrequire(\"lmtest\")\nrequire(\"plyr\")\n\nrm(list=ls());\ngc();\ngc();\n\n\n## load the data ------------------------------------------ \ndf = read.dta(\"tradedata.dta\")\nwriteMat('tradedata_original.mat',dataset = df)\ndff = df;\ndf = subset(df,trade>0);\ndff = subset(dff,trade>0);\n# take a log\ndff[-c(1,2)] = log(dff[-c(1,2)]);\n\n\ndf = ddply(df, c(\"origin\"), transform, x_jj = gdp_destination - sum(trade))\n# drop the observations\ndf = subset(df,x_jj>0);\n# take the log\ndf[-c(1,2)] = log(df[-c(1,2)]);\n\n# log ratio\ndf$ratio = df$trade-df$x_jj;\n\n\n## dummy for (b)\ndf_b = df;\nfor(level in unique(df_b$origin)){\n        df_b[paste(\"origin_dummy\", level, sep = \"_\")] <- ifelse(df_b$origin == level, 1, 0)\n}\n\nfor(level in unique(df_b$destination)){\n        df_b[paste(\"destination_dummy\", level, sep = \"_\")] <- ifelse(df_b$destination == level, 1, 0)\n}\n\n# names\na = df$origin;\nb = df$destination;\nc = rbind(a,b);\nc = c[1,];\ntotal_name = unique(c);\n\n# dummy for (c)\ndf_c = df;\nfor(level in unique(total_name)){\n        a = as.numeric(df_c$origin     ==level);\n        b = as.numeric(df_c$destination==level);\n        c = a-b;\n        df_c[paste(\"dummy\", level, sep = \"_\")] <- c\n}\n\n# dummy for (d)\ndf_d = df;\nfor(level in unique(total_name)){\n        a = as.numeric(df_d$origin     ==level);\n        b = as.numeric(df_d$destination==level);\n        c = a+b;\n        df_d[paste(\"dummy\", level, sep = \"_\")] <- c\n}\n\n# dummy for 2 (c)\ndf_2 = df_d;\nfor(level in unique(total_name)){\n        df_2[paste(\"additional_destination_dummy\", level, sep = \"_\")] <- ifelse(df_2$destination == level, 1, 0)\n}\n\n\n# data set for matlab\nattach(df)\nN_country = dim(as.matrix(total_name));\nGDP = as.matrix(gdp_destination[1:N_country])\ndf_matlab = df[c(1,2,6,7,8,10)];\nwriteMat('data_Q3.mat',dataset = df_matlab)\n\n\n\n\ndf_import_export = data.frame(export = tapply(dff$trade,dff$destination,mean), import = tapply(dff$trade,dff$origin,mean))\n\ndf_b = df_b[-c(1,2,4,5,6,7,9,10)]; # 3 = distance , 8 = trade flow\ndf_c = df_c[-c(1,2,4,5,6,7,8,9)];\ndf_d = df_d[-c(1,2,4,5,6,7,9,10)];\ndf_2 = df_2[-c(1,2,4,5,6,7,9,10)];\n\n\nsave.image(\"trade_data_set_cleaned\")\n\n\n\n\n#export =  tapply(df$trade,df$destination,mean)\n#export = data.frame(names(export),export)\n#names(export)[1]= c(\"destination\")\n#merge(df$destination,export,by = c(\"destination\"))\n#import =  tapply(df$trade,df$destination,mean)\n\n#df_sub= ddply(df, c(\"origin\"), transform, x_jj = gdp_destination - sum(trade))\n#df_sub = subset(df_sub,x_jj>0);\n#df_sub = subset(df_sub,trade>0);\n#df_sub[-c(1,2)] = log(df_sub[-c(1,2)]);\n#df=ddply(df, c(\"destination\"),  transform, trade_sum_destination = sum(trade))\n#df_sub$ratio = df_sub$trade-df_sub$x_jj;\n#write.csv(file = 'tradedata.csv',x = df)\n# drop the observations\n#df = subset(df,trade>0);\n#df=ddply(df, c(\"origin\"),  transform, trade_sum_origin = sum(trade))\n\n\n",
    "created" : 1401060793900.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "546754654",
    "id" : "AFCA9F91",
    "lastKnownWriteTime" : 1401222799,
    "path" : "~/Dropbox/Matlab/460(Allen)/PS3/Q1_data_setup.R",
    "project_path" : "Q1_data_setup.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}